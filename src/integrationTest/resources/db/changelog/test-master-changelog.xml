<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.8.xsd">

    <changeSet id="ECS-6: hibernate-integration" author="emil.rycombel@er-code.net">
        <tagDatabase tag="sales-xp-0.0.1"/>
    </changeSet>

    <changeSet id="20241021-sxp_product-add_make" author="emil.rycombel@er-code.net">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="t">
                <![CDATA[
                select count(*) < 1
                from information_schema.columns
                where table_name = 'sxp_product'
                  and column_name = 'make'
                ]]>
            </sqlCheck>
        </preConditions>
        <sql splitStatements="false">
            alter table sxp_product
                add column make varchar(250);
        </sql>
    </changeSet>

    <changeSet id="20241021-sxp_product-product-catalogue-id" author="emil.rycombel@er-code.net">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="t">
                <![CDATA[
                select count(*) < 1
                from information_schema.columns
                where table_name = 'sxp_allegro_offer'
                  and column_name = 'catalogue_product_id'
                ]]>
            </sqlCheck>
        </preConditions>
        <sql splitStatements="false">
            alter table sxp_allegro_offer
                add column catalogue_product_id varchar(150);
        </sql>
    </changeSet>

    <changeSet id="20241021-sxp_allegro-order-platform-user" author="emil.rycombel@er-code.net">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="t">
                <![CDATA[
                select count(*) < 1
                from information_schema.columns
                where table_name = 'sxp_allegro_order'
                  and column_name = 'platform_user_id'
                ]]>
            </sqlCheck>
        </preConditions>
        <sql splitStatements="false">
            alter table sxp_allegro_order
                add column platform_user_id varchar(150);
        </sql>
    </changeSet>

    <changeSet id="audit-tables" author="emil.rycombel@er-code.net">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="t">
                <![CDATA[
                select count(*) < 1
                from information_schema.tables
                where table_name = 'sxp_allegro_offer_aud'
                ]]>
            </sqlCheck>
        </preConditions>
        <sql splitStatements="false">
            CREATE SEQUENCE REVINFO_SEQ
                START WITH 1 -- starting value of the sequence
                INCREMENT BY 50 -- increment size
                NO MAXVALUE -- no maximum value
                NO CYCLE;

            select nextval('REVINFO_SEQ');
            create sequence hibernate_sequence start with 1 increment by 1;
            select nextval('hibernate_sequence');

            create table sxp_allegro_offer_AUD
            (
                sxp_allegro_offer_id varchar(26)                not null,
                REV                  integer                    not null,
                REVTYPE              smallint,
                offer_id             varchar(150)               not null,
                external_id          varchar(150)               not null,
                stock                integer          default 0 not null,
                status               varchar(150),
                price                double precision default 0 not null,
                name                 varchar(250),
                primary key (sxp_allegro_offer_id, REV)
            );

            create table REVINFO
            (
                REV      bigint,--integer generated by default as identity,
                REVTSTMP bigint,
                primary key (REV)
            );

            alter table sxp_allegro_offer_AUD
                add constraint FK5ecvi1a0ykunrriib7j28vpdj
                    foreign key (REV)
                        references REVINFO
        </sql>
    </changeSet>

    <!--
    <changeSet id="20211022-prepare-schema-script" author="emil.rycombel@er-code.net">
        <sqlFile path="/scripts/base.sql"
                 splitStatements="true"
                 relativeToChangelogFile="true"
                 stripComments="true"/>
    </changeSet>

        <changeSet id="20240409-KOFF-SUPPLIER" author="emil.rycombel@er-code.net">
            <preConditions>
                <sqlCheck expectedResult="0">select count(*)
                                             from sxp_supplier
                                             where code = 'KOFF'</sqlCheck>
            </preConditions>
            <sql>
                INSERT INTO sxp_supplier (sxp_supplier_id, name, code, description)
                VALUES ('01HV1RZ780R3Y2SSKVM5PXMW1C', 'KOFF Distributions', 'KOFF', 'Mobile Accesories from Romania');
            </sql>
        </changeSet>

        <changeSet id="20240328-Custom-fetch-koff-stock" author="emil.rycombel@er-code.net">
            <customChange class="pl.er.code.salesxp.infrastructure.persistence.migrate.liquibase.UseCaseImporter">
                <param name="changeType" value="SXP_SUPPLIER_STOCK_REFRESH"/>
            </customChange>
        </changeSet>

        <changeSet id="20240328-Custom-changeset" author="emil.rycombel@er-code.net">
            <customChange class="pl.er.code.salesxp.infrastructure.persistence.migrate.liquibase.ImportDataCustomChange">
                <param name="changeType" value="DUMMY"/>
                <param name="path" value="test-properties/dummy_importer.csv"/>
            </customChange>
        </changeSet>

        <changeSet id="20240328-Custom-changeset-0xKpRdXf" author="emil.rycombel@er-code.net">
            <customChange class="pl.er.code.salesxp.infrastructure.persistence.migrate.liquibase.ImportDataCustomChange">
                <param name="changeType" value="SXP_ORDER"/>
                <param name="path" value="imports/orders/koff/orders.csv"/>
            </customChange>
        </changeSet>

        <changeSet id="20240328-Custom-changeset-fKaMZDJ0-lines" author="emil.rycombel@er-code.net">
            <customChange class="pl.er.code.salesxp.infrastructure.persistence.migrate.liquibase.ImportDataCustomChange">
                <param name="changeType" value="SXP_ORDER_LINE"/>
                <param name="path" value="imports/orders/koff/fKaMZDJ0.csv"/>
            </customChange>
        </changeSet>
        <changeSet id="20240328-Custom-changeset-UHNqJ9AS-lines" author="emil.rycombel@er-code.net">
            <customChange class="pl.er.code.salesxp.infrastructure.persistence.migrate.liquibase.ImportDataCustomChange">
                <param name="changeType" value="SXP_ORDER_LINE"/>
                <param name="path" value="imports/orders/koff/UHNqJ9AS.csv"/>
            </customChange>
        </changeSet>
        <changeSet id="20240328-Custom-changeset-op8UcEpX-lines" author="emil.rycombel@er-code.net">
            <customChange class="pl.er.code.salesxp.infrastructure.persistence.migrate.liquibase.ImportDataCustomChange">
                <param name="changeType" value="SXP_ORDER_LINE"/>
                <param name="path" value="imports/orders/koff/op8UcEpX.csv"/>
            </customChange>
        </changeSet>
        <changeSet id="20240328-Custom-changeset-hphtdqev-lines" author="emil.rycombel@er-code.net">
            <customChange class="pl.er.code.salesxp.infrastructure.persistence.migrate.liquibase.ImportDataCustomChange">
                <param name="changeType" value="SXP_ORDER_LINE"/>
                <param name="path" value="imports/orders/koff/hphtdqev.csv"/>
            </customChange>
        </changeSet>
        <changeSet id="20240328-Custom-changeset-ZiIFJUbF-lines" author="emil.rycombel@er-code.net">
            <customChange class="pl.er.code.salesxp.infrastructure.persistence.migrate.liquibase.ImportDataCustomChange">
                <param name="changeType" value="SXP_ORDER_LINE"/>
                <param name="path" value="imports/orders/koff/ZiIFJUbF.csv"/>
            </customChange>
        </changeSet>
        <changeSet id="20240328-Custom-changeset-h8iRghaL-lines" author="emil.rycombel@er-code.net">
            <customChange class="pl.er.code.salesxp.infrastructure.persistence.migrate.liquibase.ImportDataCustomChange">
                <param name="changeType" value="SXP_ORDER_LINE"/>
                <param name="path" value="imports/orders/koff/h8iRghaL.csv"/>
            </customChange>
        </changeSet>
        <changeSet id="20240328-Custom-changeset-WbHngpX0-lines" author="emil.rycombel@er-code.net">
            <customChange class="pl.er.code.salesxp.infrastructure.persistence.migrate.liquibase.ImportDataCustomChange">
                <param name="changeType" value="SXP_ORDER_LINE"/>
                <param name="path" value="imports/orders/koff/WbHngpX0.csv"/>
            </customChange>
        </changeSet>
        <changeSet id="20240328-Custom-changeset-0xKpRdXf-lines" author="emil.rycombel@er-code.net">
            <customChange class="pl.er.code.salesxp.infrastructure.persistence.migrate.liquibase.ImportDataCustomChange">
                <param name="changeType" value="SXP_ORDER_LINE"/>
                <param name="path" value="imports/orders/koff/0xKpRdXf.csv"/>
            </customChange>
        </changeSet>
        <changeSet id="20240328-Custom-changeset-EORNVa1P-lines" author="emil.rycombel@er-code.net">
            <customChange class="pl.er.code.salesxp.infrastructure.persistence.migrate.liquibase.ImportDataCustomChange">
                <param name="changeType" value="SXP_ORDER_LINE"/>
                <param name="path" value="imports/orders/koff/EORNVa1P.csv"/>
            </customChange>
        </changeSet>
        <changeSet id="20240328-Custom-changeset-uh5ZLQjv-lines" author="emil.rycombel@er-code.net">
            <customChange class="pl.er.code.salesxp.infrastructure.persistence.migrate.liquibase.ImportDataCustomChange">
                <param name="changeType" value="SXP_ORDER_LINE"/>
                <param name="path" value="imports/orders/koff/uh5ZLQjv.csv"/>
            </customChange>
        </changeSet>
        <changeSet id="20240328-Custom-changeset-R7Jcyhr9-lines" author="emil.rycombel@er-code.net">
            <customChange class="pl.er.code.salesxp.infrastructure.persistence.migrate.liquibase.ImportDataCustomChange">
                <param name="changeType" value="SXP_ORDER_LINE"/>
                <param name="path" value="imports/orders/koff/R7Jcyhr9.csv"/>
            </customChange>
        </changeSet>
        <changeSet id="20240328-Custom-changeset-4Y9HutqI-lines" author="emil.rycombel@er-code.net">
            <customChange class="pl.er.code.salesxp.infrastructure.persistence.migrate.liquibase.ImportDataCustomChange">
                <param name="changeType" value="SXP_ORDER_LINE"/>
                <param name="path" value="imports/orders/koff/4Y9HutqI.csv"/>
            </customChange>
        </changeSet>
        <changeSet id="20240328-Custom-changeset-TmLLI9aa-lines" author="emil.rycombel@er-code.net">
            <customChange class="pl.er.code.salesxp.infrastructure.persistence.migrate.liquibase.ImportDataCustomChange">
                <param name="changeType" value="SXP_ORDER_LINE"/>
                <param name="path" value="imports/orders/koff/TmLLI9aa.csv"/>
            </customChange>
        </changeSet>
        <changeSet id="20240328-Custom-changeset-GF5p4opI-lines" author="emil.rycombel@er-code.net">
            <customChange class="pl.er.code.salesxp.infrastructure.persistence.migrate.liquibase.ImportDataCustomChange">
                <param name="changeType" value="SXP_ORDER_LINE"/>
                <param name="path" value="imports/orders/koff/GF5p4opI.csv"/>
            </customChange>
        </changeSet>
        <changeSet id="20240328-Custom-changeset-WyGIQIvV-lines" author="emil.rycombel@er-code.net">
            <customChange class="pl.er.code.salesxp.infrastructure.persistence.migrate.liquibase.ImportDataCustomChange">
                <param name="changeType" value="SXP_ORDER_LINE"/>
                <param name="path" value="imports/orders/koff/WyGIQIvV.csv"/>
            </customChange>
        </changeSet>
        <changeSet id="20240328-Custom-changeset-U30k0EsE-lines" author="emil.rycombel@er-code.net">
            <customChange class="pl.er.code.salesxp.infrastructure.persistence.migrate.liquibase.ImportDataCustomChange">
                <param name="changeType" value="SXP_ORDER_LINE"/>
                <param name="path" value="imports/orders/koff/U30k0EsE.csv"/>
            </customChange>
        </changeSet>
        <changeSet id="20240328-Custom-changeset-FyPXeq2Y-lines" author="emil.rycombel@er-code.net">
            <customChange class="pl.er.code.salesxp.infrastructure.persistence.migrate.liquibase.ImportDataCustomChange">
                <param name="changeType" value="SXP_ORDER_LINE"/>
                <param name="path" value="imports/orders/koff/FyPXeq2Y.csv"/>
            </customChange>
        </changeSet>
        <changeSet id="20240328-Custom-changeset-QTT6RRfj-lines" author="emil.rycombel@er-code.net">
            <customChange class="pl.er.code.salesxp.infrastructure.persistence.migrate.liquibase.ImportDataCustomChange">
                <param name="changeType" value="SXP_ORDER_LINE"/>
                <param name="path" value="imports/orders/koff/QTT6RRfj.csv"/>
            </customChange>
        </changeSet>
        <changeSet id="20240328-Custom-changeset-9GEO0qk1-lines" author="emil.rycombel@er-code.net">
            <customChange class="pl.er.code.salesxp.infrastructure.persistence.migrate.liquibase.ImportDataCustomChange">
                <param name="changeType" value="SXP_ORDER_LINE"/>
                <param name="path" value="imports/orders/koff/9GEO0qk1.csv"/>
            </customChange>
        </changeSet>
        <changeSet id="20240328-Custom-changeset-YJJfuLAQ-lines" author="emil.rycombel@er-code.net">
            <customChange class="pl.er.code.salesxp.infrastructure.persistence.migrate.liquibase.ImportDataCustomChange">
                <param name="changeType" value="SXP_ORDER_LINE"/>
                <param name="path" value="imports/orders/koff/YJJfuLAQ.csv"/>
            </customChange>
        </changeSet>
        <changeSet id="20240328-Custom-changeset-0b3Thffi-lines" author="emil.rycombel@er-code.net">
            <customChange class="pl.er.code.salesxp.infrastructure.persistence.migrate.liquibase.ImportDataCustomChange">
                <param name="changeType" value="SXP_ORDER_LINE"/>
                <param name="path" value="imports/orders/koff/0b3Thffi.csv"/>
            </customChange>
        </changeSet>
        <changeSet id="20240328-Custom-changeset-eEHx8y4y-lines" author="emil.rycombel@er-code.net">
            <customChange class="pl.er.code.salesxp.infrastructure.persistence.migrate.liquibase.ImportDataCustomChange">
                <param name="changeType" value="SXP_ORDER_LINE"/>
                <param name="path" value="imports/orders/koff/eEHx8y4y.csv"/>
            </customChange>
        </changeSet>
        <changeSet id="20240328-Custom-changeset-jnFELpEN-lines" author="emil.rycombel@er-code.net">
            <customChange class="pl.er.code.salesxp.infrastructure.persistence.migrate.liquibase.ImportDataCustomChange">
                <param name="changeType" value="SXP_ORDER_LINE"/>
                <param name="path" value="imports/orders/koff/jnFELpEN.csv"/>
            </customChange>
        </changeSet>
        <changeSet id="20240328-Custom-changeset-TfFskBI6-lines" author="emil.rycombel@er-code.net">
            <customChange class="pl.er.code.salesxp.infrastructure.persistence.migrate.liquibase.ImportDataCustomChange">
                <param name="changeType" value="SXP_ORDER_LINE"/>
                <param name="path" value="imports/orders/koff/TfFskBI6.csv"/>
            </customChange>
        </changeSet>
        <changeSet id="20240328-Custom-changeset-wUKVaEUj-lines" author="emil.rycombel@er-code.net">
            <customChange class="pl.er.code.salesxp.infrastructure.persistence.migrate.liquibase.ImportDataCustomChange">
                <param name="changeType" value="SXP_ORDER_LINE"/>
                <param name="path" value="imports/orders/koff/wUKVaEUj.csv"/>
            </customChange>
        </changeSet>
        <changeSet id="20240328-Custom-changeset-cXdhN0vN-lines" author="emil.rycombel@er-code.net">
            <customChange class="pl.er.code.salesxp.infrastructure.persistence.migrate.liquibase.ImportDataCustomChange">
                <param name="changeType" value="SXP_ORDER_LINE"/>
                <param name="path" value="imports/orders/koff/cXdhN0vN.csv"/>
            </customChange>
        </changeSet>
        <changeSet id="20240328-Custom-changeset-h1AaegbK-lines" author="emil.rycombel@er-code.net">
            <customChange class="pl.er.code.salesxp.infrastructure.persistence.migrate.liquibase.ImportDataCustomChange">
                <param name="changeType" value="SXP_ORDER_LINE"/>
                <param name="path" value="imports/orders/koff/h1AaegbK.csv"/>
            </customChange>
        </changeSet>
        <changeSet id="20240328-Custom-changeset-oZRc27q6-lines" author="emil.rycombel@er-code.net">
            <customChange class="pl.er.code.salesxp.infrastructure.persistence.migrate.liquibase.ImportDataCustomChange">
                <param name="changeType" value="SXP_ORDER_LINE"/>
                <param name="path" value="imports/orders/koff/oZRc27q6.csv"/>
            </customChange>
        </changeSet>
        <changeSet id="20240328-Custom-changeset-PXyXtKr7-lines" author="emil.rycombel@er-code.net">
            <customChange class="pl.er.code.salesxp.infrastructure.persistence.migrate.liquibase.ImportDataCustomChange">
                <param name="changeType" value="SXP_ORDER_LINE"/>
                <param name="path" value="imports/orders/koff/PXyXtKr7.csv"/>
            </customChange>
        </changeSet>
        <changeSet id="20240328-Custom-changeset-Pwzu6ToD-lines" author="emil.rycombel@er-code.net">
            <customChange class="pl.er.code.salesxp.infrastructure.persistence.migrate.liquibase.ImportDataCustomChange">
                <param name="changeType" value="SXP_ORDER_LINE"/>
                <param name="path" value="imports/orders/koff/Pwzu6ToD.csv"/>
            </customChange>
        </changeSet>
        <changeSet id="20240328-Custom-changeset-B23QXFht-lines" author="emil.rycombel@er-code.net">
            <customChange class="pl.er.code.salesxp.infrastructure.persistence.migrate.liquibase.ImportDataCustomChange">
                <param name="changeType" value="SXP_ORDER_LINE"/>
                <param name="path" value="imports/orders/koff/B23QXFht.csv"/>
            </customChange>
        </changeSet>
        <changeSet id="20240328-Custom-changeset-RbYQXU7y-lines" author="emil.rycombel@er-code.net">
            <customChange class="pl.er.code.salesxp.infrastructure.persistence.migrate.liquibase.ImportDataCustomChange">
                <param name="changeType" value="SXP_ORDER_LINE"/>
                <param name="path" value="imports/orders/koff/RbYQXU7y.csv"/>
            </customChange>
        </changeSet>
        <changeSet id="20240328-Custom-changeset-ABHAcL0R-lines" author="emil.rycombel@er-code.net">
            <customChange class="pl.er.code.salesxp.infrastructure.persistence.migrate.liquibase.ImportDataCustomChange">
                <param name="changeType" value="SXP_ORDER_LINE"/>
                <param name="path" value="imports/orders/koff/ABHAcL0R.csv"/>
            </customChange>
        </changeSet>
        <changeSet id="20240328-Custom-changeset-Xcsz6oH7-lines" author="emil.rycombel@er-code.net">
            <customChange class="pl.er.code.salesxp.infrastructure.persistence.migrate.liquibase.ImportDataCustomChange">
                <param name="changeType" value="SXP_ORDER_LINE"/>
                <param name="path" value="imports/orders/koff/Xcsz6oH7.csv"/>
            </customChange>
        </changeSet>

        <changeSet id="20240614-Custom-changeset-q9HNm9db-lines" author="emil.rycombel@er-code.net">
            <customChange class="pl.er.code.salesxp.infrastructure.persistence.migrate.liquibase.ImportDataCustomChange">
                <param name="changeType" value="SXP_ORDER_LINE"/>
                <param name="path" value="imports/orders/koff/q9HNm9db.csv"/>
            </customChange>
        </changeSet>

    -->
</databaseChangeLog>
